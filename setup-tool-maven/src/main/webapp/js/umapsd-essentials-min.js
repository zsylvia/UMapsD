function Connection(a,t){this.marker=a,this.distance=t,this.toString=function(){return marker1.data(GlobalStrings.ID)+"-"+t}}function raphaelSetup(){for(var a=dictionary.buildings,t=0,r=a.length;r>t;t++){var o=a[t],n=o.floors;floorIdList=new buckets.LinkedList,tmpList=new buckets.LinkedList;for(var e=0,l=n.length;l>e;e++)tmpList.add(n[e].id);for(var e=0,l=n.length;l>e;e++)flr=tmpList.first(),tmpList.forEach(function(a){a<flr&&(flr=a)}),tmpList.remove(flr),floorIdList.add(flr);buildingToFloorIdsMap.set(o.short_id,floorIdList)}for(var i=dictionary.parkinglots,t=0;t<i.length;t++){var s=i[t],p=paper.path(s.path).data(GlobalStrings.ID,s.short_id),g=Raphael.pathBBox(s.path),d=g.x+g.width/2,u=g.y+g.height/2;paper.text(d,u,s.full_id).attr({"font-size":10}).toFront(),p.attr({fill:"#fddcac","fill-opacity":.75,stroke:"white","stroke-opacity":1})}for(var S=dictionary.dorms,t=0;t<S.length;t++){var s=S[t],p=paper.path(s.path).data(GlobalStrings.ID,s.short_id),g=Raphael.pathBBox(s.path),d=g.x+g.width/2,u=g.y+g.height/2;paper.text(d,u,s.full_id).attr({"font-size":10}).toFront(),p.attr({fill:"#fddcac","fill-opacity":.75,stroke:"white","stroke-opacity":1})}for(var c=dictionary.paths,t=0,b=c.length;b>t;t++){var s=c[t],p=paper.path(s.path);p.attr({fill:"black",stroke:"black"})}hasGraph=loadGraphData(),showShapesForCurrentBuildingAndFloor(),dictionaryLoaded=!0}function loadGraphData(){var a=(new Date).getTime(),t=null;try{t=graphJS}catch(r){"ReferenceError"==r.name||console.error(r.stack)}return null!=t?(createAllMarkersFromJson(t,paper).forEach(function(a,t){typeToMarkerMap.get(t.data(GlobalStrings.TYPE)).set(a,t)}),createAllPathsFromJson(t,paper).forEach(function(a,t){pathMap.set(a,t)}),LOG.trace("Took "+(now()-a)+" ms to load graph data"),!0):(LOG.trace("Took "+(now()-a)+" ms to load graph data"),!1)}function loadShapesForBuildingAndFloor(a,t){var r=now(),o=buildingToFloorMap;if(!o.containsKey(a)||!o.get(a).containsKey(t)){LOG.debug("Loading shapes for building "+a+" and floor "+t);for(var n=dictionary.buildings,e=0,l=0,i=0,s=(new Date).getTime(),p=0,g=n.length;g>p;p++){var d=n[p];if(buildingShortToLongNameMap.set(d.short_id,d.full_id),a==GlobalStrings.ALL_BUILDINGS||d.short_id==a){if(o.containsKey(d.short_id)&&o.get(d.short_id).containsKey(t))continue;var u=o.get(d.short_id);null==u&&(u=new buckets.Dictionary);for(var S=d.floors,c=0,b=S.length;b>c;c++){var h=S[c];if(h.id==t){var G=u.get(h.id);null==G&&(G=new buckets.Dictionary);var f=G.get("shapes");null==f&&(f=new buckets.LinkedList(function(a){return a.data(GlobalStrings.ID)}));var M=G.get("names");null==M&&(M=new buckets.LinkedList);for(var T=h.shapes,I=0,D=T.length;D>I;I++){var m=T[I];if(""!=m.path){var k=(new Date).getTime();if("outline"==m.id)var O=paper.path(m.path).data(GlobalStrings.ID,m.id).attr({fill:"gray","fill-opacity":.1,stroke:"white","stroke-opacity":1}).toBack();else var O=paper.path(m.path).data(GlobalStrings.ID,m.id).attr({fill:"#fddcac","fill-opacity":.75,stroke:"white","stroke-opacity":1});e+=(new Date).getTime()-k;var k=now(),y=Raphael.pathBBox(m.path),A=y.x+y.width/2,L=y.y+y.height/2;i+=now()-k;var k=now();M.add(paper.text(A,L,findTypeSpecificId(m.id)).attr({"font-size":10})),l+=now()-k,f.add(O)}}G.set("shapes",f),G.set("names",M),u.set(h.id,G)}}buildingToFloorMap.set(d.short_id,u)}}LOG.trace("Took "+e+" ms to create all shapes"),LOG.trace("Took "+i+" ms to find centers"),LOG.trace("Took "+l+" ms to create all text"),LOG.trace("Took "+(now()-s)+" ms to finish the loop"),LOG.trace("Took "+((new Date).getTime()-r)+" ms to load shapes for "+a+" floor "+t)}}function showShapesForBuildingAndFloor(a,t){loadShapesForBuildingAndFloor(a,t);var r=now();LOG.debug("Showing shapes for building "+a+" and floor "+t);var o=999999,n=999999,e=0,l=a==GlobalStrings.ALL_BUILDINGS;buildingToFloorMap.forEach(function(r,i){i.forEach(function(i,s){var p=s.get("shapes"),g=s.get("names");!l&&a!=r||t!=i?(p.forEach(function(a){a.hide()}),g.forEach(function(a){a.hide()})):(p.forEach(function(a){a.show();var t=now(),r=a.getBBox();r.x<o&&(o=r.x),r.y<n&&(n=r.y),e+=now()-t}),g.forEach(function(a){a.show()}))})}),paperShiftX=Math.floor(o),paperShiftY=Math.floor(n),paper.setViewBox(paperShiftX,paperShiftY,paperWidth,paperHeight,!1),LOG.trace("Took "+((new Date).getTime()-r)+" ms to show shapes for "+a+" floor "+t+". bbox time = "+e),hasGraph&&showMarkersForCurrentBuildingAndFloor(),resizeToFitShapesForBuildingAndFloor(a,t)}function showShapesForCurrentBuildingAndFloor(){LOG.debug("Showing shapes for current building and floor"),showShapesForBuildingAndFloor(currentBuilding,currentFloor)}function idIsType(a,t){switch(t){case GlobalStrings.ROOM:if(a.lastIndexOf(GlobalStrings.ROOM_ID+"_")>-1)return!0;break;case GlobalStrings.DOOR:if(a.lastIndexOf(GlobalStrings.DOOR_ID+"_")>-1)return!0;break;case GlobalStrings.HALLWAY:if(a.lastIndexOf(GlobalStrings.HALLWAY_ID)+"_">-1)return!0;break;case GlobalStrings.PATHWAY:if(a.lastIndexOf(GlobalStrings.PATHWAY_ID+"_")>-1)return!0;break;case GlobalStrings.STAIR:if(a.lastIndexOf(GlobalStrings.STAIR_ID+"_")>-1)return!0;break;case GlobalStrings.ELEVATOR:if(a.lastIndexOf(GlobalStrings.ELEVATOR_ID+"_")>-1)return!0;break;case GlobalStrings.BATHROOM_MENS:if(a.lastIndexOf(GlobalStrings.BATHROOM_MENS_ID+"_")>-1)return!0;break;case GlobalStrings.BATHROOM_WOMENS:if(a.lastIndexOf(GlobalStrings.BATHROOM_WOMENS_ID+"_")>-1)return!0}return!1}function idIsValid(a){return idIsType(a,GlobalStrings.ROOM)?!0:idIsType(a,GlobalStrings.DOOR)?!0:idIsType(a,GlobalStrings.HALLWAY)?!0:idIsType(a,GlobalStrings.PATHWAY)?!0:idIsType(a,GlobalStrings.STAIR)?!0:idIsType(a,GlobalStrings.ELEVATOR)?!0:idIsType(a,GlobalStrings.BATHROOM_MENS)?!0:idIsType(a,GlobalStrings.BATHROOM_WOMENS)?!0:!1}function showPathsForMarker(a,t,r){LOG.trace("Showing paths for marker "+a.data(GlobalStrings.ID)+" building "+t+" floor "+r);var o=typeToConnectionMap.get(a.data(GlobalStrings.TYPE)).get(a);if(null!=o){var n=pathMap;o.forEach(function(o){if(o.marker.data(GlobalStrings.TYPE)==GlobalStrings.PATHWAY||(t==GlobalStrings.ALL_BUILDINGS||o.marker.data(GlobalStrings.BUILDING))&&o.marker.data(GlobalStrings.FLOOR)==r){var e=n.get(a.data(GlobalStrings.ID)+"<->"+o.marker.data(GlobalStrings.ID));null==e&&(e=n.get(o.marker.data(GlobalStrings.ID)+"<->"+a.data(GlobalStrings.ID))),null!=e?e.element.show().toFront():LOG.error("Could not find path between "+a.data(GlobalStrings.ID)+" and "+o.marker.data(GlobalStrings.ID))}})}}function hidePathsForMarker(a,t,r){LOG.trace("Hiding paths for marker "+a.data(GlobalStrings.ID)+" building "+t+" floor "+r);var o=typeToConnectionMap.get(a.data(GlobalStrings.TYPE)).get(a);if(null!=o){var n=pathMap;o.forEach(function(o){if(o.marker.data(GlobalStrings.TYPE)==GlobalStrings.PATHWAY||(t==GlobalStrings.ALL_BUILDINGS||o.marker.data(GlobalStrings.BUILDING))&&o.marker.data(GlobalStrings.FLOOR)==r){var e=n.get(a.data(GlobalStrings.ID)+"<->"+o.marker.data(GlobalStrings.ID));null==e&&(e=n.get(o.marker.data(GlobalStrings.ID)+"<->"+a.data(GlobalStrings.ID))),null!=e?e.element.hide():LOG.error("Could not find path between "+a.data(GlobalStrings.ID)+" and "+o.marker.data(GlobalStrings.ID))}})}}function showMarkersForCurrentBuildingAndFloor(){LOG.debug("Showing markers for current building and floor"),showMarkersForBuildingAndFloor(currentBuilding,currentFloor)}function showMarkersForBuildingAndFloor(a,t){loadMarkersForBuildingAndFloor(a,t);var r=(new Date).getTime();markersInvisible||(showPathsForBuildingAndFloor(a,t),hidePathsForBuildingAndFloor(a,t),LOG.debug("Showing markers for building "+a+" floor "+t),allMarkers.forEach(function(r){r.forEach(function(r,o){o.data(GlobalStrings.TYPE)==GlobalStrings.PATHWAY||o.data(GlobalStrings.TYPE)==GlobalStrings.PARKING_LOT?o.show().toFront():a!=GlobalStrings.ALL_BUILDINGS&&o.data(GlobalStrings.BUILDING)!=a||o.data(GlobalStrings.FLOOR)!=t?(o.hide(),hidePathsForMarker(o,a,t)):o.show().toFront()})})),LOG.trace("Took "+((new Date).getTime()-r)+" ms to show markers for "+a+" floor "+t)}function showPathsForBuildingAndFloor(a,t){LOG.trace("Showing paths for "+a+" floor "+t),markersInvisible||pathMap.forEach(function(r,o){a!=GlobalStrings.ALL_BUILDINGS?o.marker1Data.type!=GlobalStrings.PATHWAY&&o.marker2Data.type!=GlobalStrings.PATHWAY&&o.marker1Data.building==a&&o.marker1Data.floor==t&&o.marker2Data.building==a&&o.marker2Data.floor==t&&o.element.show().toFront():o.marker1Data.type!=GlobalStrings.PATHWAY&&o.marker2Data.type!=GlobalStrings.PATHWAY&&o.marker1Data.floor==t&&o.marker2Data.floor==t&&o.element.show().toFront()})}function hidePathsForBuildingAndFloor(a,t){LOG.trace("Hiding paths for everything NOT "+a+" floor "+t),pathMap.forEach(function(r,o){a!=GlobalStrings.ALL_BUILDINGS?o.marker1Data.type!=GlobalStrings.PATHWAY&&o.marker2Data.type!=GlobalStrings.PATHWAY&&(o.marker1Data.building!=a||o.marker1Data.floor!=t||o.marker2Data.building!=a||o.marker2Data.floor!=t)&&o.element.hide():o.marker1Data.type!=GlobalStrings.PATHWAY&&o.marker2Data.type!=GlobalStrings.PATHWAY&&o.marker1Data.floor!=t&&o.marker2Data.floor!=t&&o.element.hide()})}function loadMarkersForBuildingAndFloor(a,t){var r=(new Date).getTime(),o=loadedBuildingsAndFloors;if(!(o.containsKey(a)&&o.get(a).contains(t)||o.containsKey(GlobalStrings.ALL_BUILDINGS)&&o.get(GlobalStrings.ALL_BUILDINGS).contains(t))){LOG.debug("Loading markers for building "+a+" floor "+t),allMarkers.forEach(function(a){a.forEach(function(a,t){getMarkerMapForType(t.data(GlobalStrings.TYPE)).containsKey(t.data(GlobalStrings.ID))||(setMarkerDragEventHandlers(t),getMarkerMapForType(t.data(GlobalStrings.TYPE)).containsKey(t.data(GlobalStrings.ID))||getMarkerMapForType(t.data(GlobalStrings.TYPE)).set(t.data(GlobalStrings.ID),t),typeToConnectionMap.get(t.data(GlobalStrings.TYPE)).containsKey(t)||typeToConnectionMap.get(t.data(GlobalStrings.TYPE)).set(t,newConnectionSet()),t.data(GlobalStrings.TYPE)==GlobalStrings.DOOR?doorIdCount++:t.data(GlobalStrings.TYPE)==GlobalStrings.HALLWAY?hallwayIdCount++:t.data(GlobalStrings.TYPE)==GlobalStrings.PATHWAY?pathwayIdCount++:t.data(GlobalStrings.TYPE)==GlobalStrings.STAIR?stairIdCount++:t.data(GlobalStrings.TYPE)==GlobalStrings.ELEVATOR?elevatorIdCount++:t.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_MENS?bathroomMensIdCount++:t.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_WOMENS&&bathroomWomensIdCount++)})}),pathMap.forEach(function(r,o){var n=null,e=null;if(getMarkerMapForType(o.marker1Data.type).containsKey(o.marker1Data.id)?n=getMarkerMapForType(o.marker1Data.type).get(o.marker1Data.id):o.marker1Data.type!=GlobalStrings.PATHWAY?a!=GlobalStrings.ALL_BUILDINGS&&o.marker1Data.building!=a||o.marker1Data.floor!=t||(n=getMarkerFromId(o.marker1Data.id),null==n&&(n=addMarker(o.marker1Data.cx,o.marker1Data.cy,markerTypeToColorMap.get(o.marker1Data.type)),n.data(GlobalStrings.ID,o.marker1Data.id),n.data(GlobalStrings.TYPE,o.marker1Data.type),n.data(GlobalStrings.BUILDING,o.marker1Data.building),n.data(GlobalStrings.FLOOR,o.marker1Data.floor),getMarkerMapForType(n.data(GlobalStrings.TYPE)).containsKey(n.data(GlobalStrings.ID))||getMarkerMapForType(n.data(GlobalStrings.TYPE)).set(n.data(GlobalStrings.ID),n),typeToConnectionMap.containsKey(n.data(GlobalStrings.TYPE))||typeToConnectionMap.get(n.data(GlobalStrings.TYPE)).set(n,newConnectionSet()),n.data(GlobalStrings.TYPE)==GlobalStrings.DOOR?doorIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.HALLWAY?hallwayIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.PATHWAY?pathwayIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.STAIR?stairIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.ELEVATOR?elevatorIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_MENS?bathroomMensIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_WOMENS&&bathroomWomensIdCount++)):(n=addMarker(o.marker1Data.cx,o.marker1Data.cy,markerTypeToColorMap.get(o.marker1Data.type)),n.data(GlobalStrings.ID,o.marker1Data.id),n.data(GlobalStrings.TYPE,o.marker1Data.type),getMarkerMapForType(n.data(GlobalStrings.TYPE)).containsKey(n.data(GlobalStrings.ID))||getMarkerMapForType(n.data(GlobalStrings.TYPE)).set(n.data(GlobalStrings.ID),n),typeToConnectionMap.containsKey(n.data(GlobalStrings.TYPE))||typeToConnectionMap.get(n.data(GlobalStrings.TYPE)).set(n,newConnectionSet()),n.data(GlobalStrings.TYPE)==GlobalStrings.DOOR?doorIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.HALLWAY?hallwayIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.PATHWAY?pathwayIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.STAIR?stairIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.ELEVATOR?elevatorIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_MENS?bathroomMensIdCount++:n.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_WOMENS&&bathroomWomensIdCount++),getMarkerMapForType(o.marker2Data.type).containsKey(o.marker2Data.id)?e=getMarkerMapForType(o.marker2Data.type).get(o.marker2Data.id):o.marker2Data.type!=GlobalStrings.PATHWAY?a!=GlobalStrings.ALL_BUILDINGS&&o.marker2Data.building!=a||o.marker2Data.floor!=t||(e=getMarkerFromId(o.marker2Data.id),null==e&&(e=addMarker(o.marker2Data.cx,o.marker2Data.cy,markerTypeToColorMap.get(o.marker2Data.type)),e.data(GlobalStrings.ID,o.marker2Data.id),e.data(GlobalStrings.TYPE,o.marker2Data.type),o.marker2Data.type!=GlobalStrings.PATHWAY&&(e.data(GlobalStrings.BUILDING,o.marker2Data.building),e.data(GlobalStrings.FLOOR,o.marker2Data.floor)),getMarkerMapForType(e.data(GlobalStrings.TYPE)).containsKey(e.data(GlobalStrings.ID))||getMarkerMapForType(e.data(GlobalStrings.TYPE)).set(e.data(GlobalStrings.ID),e),typeToConnectionMap.containsKey(e.data(GlobalStrings.TYPE))||typeToConnectionMap.get(e.data(GlobalStrings.TYPE)).set(e,newConnectionSet()),e.data(GlobalStrings.TYPE)==GlobalStrings.DOOR?doorIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.HALLWAY?hallwayIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.PATHWAY?pathwayIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.STAIR?stairIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.ELEVATOR?elevatorIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_MENS?bathroomMensIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_WOMENS&&bathroomWomensIdCount++)):(e=addMarker(o.marker2Data.cx,o.marker2Data.cy,markerTypeToColorMap.get(o.marker2Data.type)),e.data(GlobalStrings.ID,o.marker2Data.id),e.data(GlobalStrings.TYPE,o.marker2Data.type),getMarkerMapForType(e.data(GlobalStrings.TYPE)).containsKey(e.data(GlobalStrings.ID))||getMarkerMapForType(e.data(GlobalStrings.TYPE)).set(e.data(GlobalStrings.ID),e),typeToConnectionMap.containsKey(e.data(GlobalStrings.TYPE))||typeToConnectionMap.get(e.data(GlobalStrings.TYPE)).set(e,newConnectionSet()),e.data(GlobalStrings.TYPE)==GlobalStrings.DOOR?doorIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.HALLWAY?hallwayIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.PATHWAY?pathwayIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.STAIR?stairIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.ELEVATOR?elevatorIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_MENS?bathroomMensIdCount++:e.data(GlobalStrings.TYPE)==GlobalStrings.BATHROOM_WOMENS&&bathroomWomensIdCount++),null!=n&&null!=e){var l=getConnectionMapForType(n.data(GlobalStrings.TYPE)),i=getConnectionMapForType(e.data(GlobalStrings.TYPE)),s=l.get(n);null==s&&(s=newConnectionSet());var p=getDistance(n,e),g=s.add(new Connection(e,p));g&&l.set(n,s);var s=i.get(e);null==s&&(s=newConnectionSet());var g=s.add(new Connection(n,p));g&&i.set(e,s),n.toFront(),e.toFront()}});var n=o.get(a);null==n&&(n=new buckets.LinkedList),n.add(t),loadedBuildingsAndFloors.set(a,n)}LOG.trace("Took "+((new Date).getTime()-r)+" ms to load markers for "+a+" floor "+t)}function setMarkersInvisible(a){LOG.trace("Setting markers invisible"),markersInvisible=a,a?(allMarkers.forEach(function(a){a.forEach(function(a,t){t.hide()})}),pathMap.forEach(function(a,t){t.element.hide()})):showMarkersForCurrentBuildingAndFloor()}function isDictionaryLoaded(){return dictionaryLoaded}function getMarkerMapForType(a){return typeToMarkerMap.get(a)}function getMarkerFromId(a){var t=null;return allMarkers.forEach(function(r){return t=r.get(a),null!=t?!1:void 0}),t}function addMarker(a,t,r){var o=paper.circle(a,t,markerSize).attr({fill:r}).toFront();return markersInvisible&&o.hide(),setMarkerDragEventHandlers(o),o}function newConnectionMap(){return new buckets.Dictionary(function(a){return a.data(GlobalStrings.ID)})}function getConnectionMapForType(a){return typeToConnectionMap.get(a)}function newConnectionSet(){return new buckets.Set(function(a){return a.marker.data(GlobalStrings.ID)})}function getDistance(a,t){return dist(a.attr("cx"),a.attr("cy"),t.attr("cx"),t.attr("cy"))}function dist(a,t,r,o){var n=0,e=0;return n=r-a,n*=n,e=o-t,e*=e,Math.floor(Math.sqrt(n+e))}function resizeToFitShapesForBuildingAndFloor(a,t){var r=(new Date).getTime(),o=999999,n=-999999;a==GlobalStrings.ALL_BUILDINGS?buildingToFloorMap.forEach(function(a,r){var e=r.get(t);null!=e&&e.get("shapes").forEach(function(a){var t=a.getBBox();t.x<o&&(o=t.x),t.y2>n&&(n=t.y2)})}):buildingToFloorMap.get(a).get(t).get("shapes").forEach(function(a){var t=a.getBBox();t.x<o&&(o=t.x),t.y2>n&&(n=t.y2)});var e=paperWidth,l=e/paperHeight,i=n-(paperShiftY+paperHeight);paperWidth+=l*i,paperHeight+=i,paperResizeRatio*=paperWidth/e,paper.setViewBox(paperShiftX,paperShiftY,paperWidth,paperHeight,!0),LOG.trace("Took "+((new Date).getTime()-r)+" ms to resize to fit shapes for "+a+" floor "+t)}function zoomIn(a){var t;t=null!=a&&1>a?a:.9,paperResizeRatio*=t,paperWidth*=t,paperHeight*=t,paper.setViewBox(paperShiftX,paperShiftY,paperWidth,paperHeight,!0)}function zoomOut(a){var t;t=null!=a&&a>1?a:1.1,paperResizeRatio*=t,paperWidth*=t,paperHeight*=t,paper.setViewBox(paperShiftX,paperShiftY,paperWidth,paperHeight,!0)}function executeOnAllMarkers(a){allMarkers.forEach(function(t){t.forEach(function(t,r){a(r)})})}function getMarkerColorFromType(a){var t=markerTypeToColorMap.get(a);return null==t&&(t="black"),t}function getBuildingFromId(a){if(-1!=a.search(GlobalStrings.PATHWAY_ID))return"";var t=a.split("_");return t[0]==GlobalStrings.BUILDING_ID?t[1]:void 0}function getFloorFromId(a){if(-1!=a.search(GlobalStrings.PATHWAY_ID))return"";var t=a.split("_");return t[0]==GlobalStrings.BUILDING_ID&&t[2]==GlobalStrings.FLOOR_ID?t[3]:void 0}function getRoomFromRoomId(a){return a.substr(a.lastIndexOf(GlobalStrings.ROOM_ID+"_")+(GlobalStrings.ROOM_ID+"_").length)}function getParkingLotFromId(a){return a.substr(a.lastIndexOf(GlobalStrings.PARKING_LOT_ID+"_")+(GlobalStrings.PARKING_LOT_ID+"_").length)}function getClosestMarkerToPoint(a,t){var r,o;return allMarkers.forEach(function(n){n.forEach(function(n,e){if(e.data(GlobalStrings.TYPE)!=GlobalStrings.PATHWAY&&e.data(GlobalStrings.TYPE)!=GlobalStrings.PARKING_LOT){if((currentBuilding==GlobalStrings.ALL_BUILDINGS||currentBuilding==e.data(GlobalStrings.BUILDING))&&currentFloor==e.data(GlobalStrings.FLOOR)){var l=dist(a,t,e.attr("cx"),e.attr("cy"));(null==r||o>l)&&(r=e,o=l)}}else{var l=dist(a,t,e.attr("cx"),e.attr("cy"));(null==r||o>l)&&(r=e,o=l)}})}),r}function formatRoomId(a,t,r){return GlobalStrings.BUILDING_ID+"_"+a+"_"+GlobalStrings.FLOOR_ID+"_"+t+"_"+GlobalStrings.ROOM_ID+"_"+r}function formatDoorId(a,t){for(var r=null;null==r;){doorIdCount++;var o=GlobalStrings.BUILDING_ID+"_"+a+"_"+GlobalStrings.FLOOR_ID+"_"+t+"_"+GlobalStrings.DOOR_ID+"_"+doorIdCount;doorMap.containsKey(o)||(r=o)}return r}function formatHallwayId(a,t){for(var r=null;null==r;){hallwayIdCount++;var o=GlobalStrings.BUILDING_ID+"_"+a+"_"+GlobalStrings.FLOOR_ID+"_"+t+"_"+GlobalStrings.HALLWAY_ID+"_"+hallwayIdCount;hallwayMap.containsKey(o)||(r=o)}return r}function formatPathwayId(){for(var a=null;null==a;){pathwayIdCount++;var t=GlobalStrings.PATHWAY_ID+"_"+pathwayIdCount;pathwayMap.containsKey(t)||(a=t)}return a}function formatStairId(a,t){for(var r=null;null==r;){stairIdCount++;var o=GlobalStrings.BUILDING_ID+"_"+a+"_"+GlobalStrings.FLOOR_ID+"_"+t+"_"+GlobalStrings.STAIR_ID+"_"+stairIdCount;stairMap.containsKey(o)||(r=o)}return r}function formatElevatorId(a,t){for(var r=null;null==r;){elevatorIdCount++;var o=GlobalStrings.BUILDING_ID+"_"+a+"_"+GlobalStrings.FLOOR_ID+"_"+t+"_"+GlobalStrings.ELEVATOR_ID+"_"+elevatorIdCount;elevatorMap.containsKey(o)||(r=o)}return r}function formatBathroomMensId(a,t){for(var r=null;null==r;){bathroomMensIdCount++;var o=GlobalStrings.BUILDING_ID+"_"+a+"_"+GlobalStrings.FLOOR_ID+"_"+t+"_"+GlobalStrings.BATHROOM_MENS_ID+"_"+bathroomMensIdCount;bathroomMensMap.containsKey(o)||(r=o)}return r}function formatBathroomWomensId(a,t){for(var r=null;null==r;){bathroomWomensIdCount++;var o=GlobalStrings.BUILDING_ID+"_"+a+"_"+GlobalStrings.FLOOR_ID+"_"+t+"_"+GlobalStrings.BATHROOM_WOMENS_ID+"_"+bathroomWomensIdCount;bathroomWomensMap.containsKey(o)||(r=o)}return r}function formatParkingLotId(a){return GlobalStrings.PARKING_LOT_ID+"_"+a}function formatDormId(a){return GlobalStrings.DORM_ID+"_"+a}function formatMiscId(a){return GlobalStrings.MISC_ID+"_"+a}function getTypeFromId(a){if(-1!=a.search(GlobalStrings.PATHWAY_ID))return GlobalStrings.PATHWAY;if(-1!=a.search(GlobalStrings.PARKING_LOT_ID))return GlobalStrings.PARKING_LOT;var t=a.split("_");if(t[0]==GlobalStrings.BUILDING_ID&&t[2]==GlobalStrings.FLOOR_ID){var r,o=t[4];return o==GlobalStrings.ROOM_ID?r=GlobalStrings.ROOM:o==GlobalStrings.DOOR_ID?r=GlobalStrings.DOOR:o==GlobalStrings.HALLWAY_ID?r=GlobalStrings.HALLWAY:o==GlobalStrings.STAIR_ID?r=GlobalStrings.STAIR:o==GlobalStrings.ELEVATOR_ID?r=GlobalStrings.ELEVATOR:o==GlobalStrings.BATHROOM_MENS_ID?r=GlobalStrings.BATHROOM_MENS:o==GlobalStrings.BATHROOM_WOMENS_ID?r=GlobalStrings.BATHROOM_WOMENS:o==GlobalStrings.PARKING_LOT_ID&&(r=GlobalStrings.PARKING_LOT),r}return null}function findTypeSpecificId(a,t){return null==t&&(t=getTypeFromId(a)),null==t?a:t==GlobalStrings.ROOM?getRoomFromRoomId(a):t==GlobalStrings.BATHROOM_MENS?GlobalStrings.BATHROOM_MENS_DISPLAY:t==GlobalStrings.BATHROOM_WOMENS?GlobalStrings.BATHROOM_WOMENS_DISPLAY:t==GlobalStrings.PARKING_LOT?GlobalStrings.PARKING_LOT+getParkingLotFromId(a):void 0}function now(){return(new Date).getTime()}function loadMarkersForAllBuildingsAndFloors(){buildingToFloorIdsMap.forEach(function(a,t){t.forEach(function(t){loadMarkersForBuildingAndFloor(a,t)})})}function loadShapesForAllBuildingsAndFloors(){buildingToFloorIdsMap.forEach(function(a,t){t.forEach(function(t){loadShapesForBuildingAndFloor(a,t)})})}function waitAndRun(a,t,r,o){setTimeout(function(){1==t||window[t]?(LOG.debug("Running function"),null!=o?r(o):r()):(LOG.debug("Not running function yet"),waitAndRun(r,a,t))},a)}var raphaelDiv="raphael",raphaelDivJQuery="#"+raphaelDiv,paper,totalCenterX,totalCenterY,loadedBuildingsAndFloors=new buckets.Dictionary,roomMap=new buckets.Dictionary,doorMap=new buckets.Dictionary,hallwayMap=new buckets.Dictionary,pathwayMap=new buckets.Dictionary,stairMap=new buckets.Dictionary,elevatorMap=new buckets.Dictionary,bathroomMensMap=new buckets.Dictionary,bathroomWomensMap=new buckets.Dictionary,parkingLotMap=new buckets.Dictionary,parkingLotShapesMap=new buckets.Dictionary,dormShapesMap=new buckets.Dictionary,pathShapesMap=new buckets.Dictionary,markerSize=5,pathStrokeWidth=4,mouseOnMarker=!1,doorIdCount=0,hallwayIdCount=0,pathwayIdCount=0,stairIdCount=0,elevatorIdCount=0,bathroomMensIdCount=0,bathroomWomensIdCount=0,allMarkers=new buckets.LinkedList;allMarkers.add(roomMap),allMarkers.add(doorMap),allMarkers.add(hallwayMap),allMarkers.add(pathwayMap),allMarkers.add(stairMap),allMarkers.add(elevatorMap),allMarkers.add(bathroomMensMap),allMarkers.add(bathroomWomensMap),allMarkers.add(parkingLotMap);var roomConnectionMap=newConnectionMap(),doorConnectionMap=newConnectionMap(),hallwayConnectionMap=newConnectionMap(),pathwayConnectionMap=newConnectionMap(),stairConnectionMap=newConnectionMap(),elevatorConnectionMap=newConnectionMap(),bathroomMensConnectionMap=newConnectionMap(),bathroomWomensConnectionMap=newConnectionMap(),parkingLotConnectionMap=newConnectionMap(),typeToConnectionMap=new buckets.Dictionary;typeToConnectionMap.set(GlobalStrings.ROOM,roomConnectionMap),typeToConnectionMap.set(GlobalStrings.DOOR,doorConnectionMap),typeToConnectionMap.set(GlobalStrings.HALLWAY,hallwayConnectionMap),typeToConnectionMap.set(GlobalStrings.PATHWAY,pathwayConnectionMap),typeToConnectionMap.set(GlobalStrings.STAIR,stairConnectionMap),typeToConnectionMap.set(GlobalStrings.ELEVATOR,elevatorConnectionMap),typeToConnectionMap.set(GlobalStrings.BATHROOM_MENS,bathroomMensConnectionMap),typeToConnectionMap.set(GlobalStrings.BATHROOM_WOMENS,bathroomWomensConnectionMap),typeToConnectionMap.set(GlobalStrings.PARKING_LOT,parkingLotConnectionMap);var typeToMarkerMap=new buckets.Dictionary;typeToMarkerMap.set(GlobalStrings.ROOM,roomMap),typeToMarkerMap.set(GlobalStrings.DOOR,doorMap),typeToMarkerMap.set(GlobalStrings.HALLWAY,hallwayMap),typeToMarkerMap.set(GlobalStrings.PATHWAY,pathwayMap),typeToMarkerMap.set(GlobalStrings.STAIR,stairMap),typeToMarkerMap.set(GlobalStrings.ELEVATOR,elevatorMap),typeToMarkerMap.set(GlobalStrings.BATHROOM_MENS,bathroomMensMap),typeToMarkerMap.set(GlobalStrings.BATHROOM_WOMENS,bathroomWomensMap),typeToMarkerMap.set(GlobalStrings.PARKING_LOT,parkingLotMap);var markerTypeToColorMap=new buckets.Dictionary;markerTypeToColorMap.set(GlobalStrings.ROOM,GlobalStrings.COLOR.RED),markerTypeToColorMap.set(GlobalStrings.DOOR,GlobalStrings.COLOR.BLUE),markerTypeToColorMap.set(GlobalStrings.HALLWAY,GlobalStrings.COLOR.ORANGE),markerTypeToColorMap.set(GlobalStrings.PATHWAY,GlobalStrings.COLOR.GREEN),markerTypeToColorMap.set(GlobalStrings.STAIR,GlobalStrings.COLOR.PURPLE),markerTypeToColorMap.set(GlobalStrings.ELEVATOR,GlobalStrings.COLOR.YELLOW),markerTypeToColorMap.set(GlobalStrings.BATHROOM_MENS,GlobalStrings.COLOR.CYAN),markerTypeToColorMap.set(GlobalStrings.BATHROOM_WOMENS,GlobalStrings.COLOR.PINK),markerTypeToColorMap.set(GlobalStrings.PARKING_LOT,GlobalStrings.COLOR.LIME);var pathMap=new buckets.Dictionary,buildingShortToLongNameMap=new buckets.Dictionary,buildingToFloorMap=new buckets.Dictionary,buildingToFloorIdsMap=new buckets.Dictionary,currentBuilding="dion",currentFloor="1",paperResizeRatio=1,paperWidth,paperHeight,paperShiftX=0,paperShiftY=0,draggingEverythingIgnoreClick=!1,markersInvisible=!0,dictionaryLoaded=!1,mouseDown=!1,currX,currY,hasGraph=!1;$(document).ready(function(){$("#view").css("width",$(window).width()),$("#view").css("height",$(window).height()-$("#body").height()),setTimeout(function(){var a=(new Date).getTime();$(raphaelDivJQuery).css("width",$("#view").width()),$(raphaelDivJQuery).css("height",$("#view").height()),paper=new ScaleRaphael(raphaelDiv,$(raphaelDivJQuery).width(),$(raphaelDivJQuery).height()),paper.setStart();paper.setFinish(),paperWidth=paper.width,paperHeight=paper.height,raphaelSetup(),$(window).resize(function(){$(raphaelDivJQuery).css("width",$(window).width()),$(raphaelDivJQuery).css("height",$(window).height()-$("#body").height()),paper.changeSize($(raphaelDivJQuery).width(),$(raphaelDivJQuery).height(),!1,!1)}),document.getElementById(raphaelDiv).addEventListener("touchstart",function(a){a.preventDefault&&a.preventDefault(),currX=a.touches[0].pageX,currY=a.touches[0].pageY,mouseDown=!0},!1),document.getElementById(raphaelDiv).addEventListener("touchmove",function(a){a.preventDefault&&a.preventDefault(),mouseDown&&!mouseOnMarker&&(a.preventDefault&&a.preventDefault(),paperShiftX=Math.floor(paperShiftX+(currX-a.touches[0].pageX)*paperResizeRatio),paperShiftY=Math.floor(paperShiftY+(currY-a.touches[0].pageY)*paperResizeRatio),currX=a.touches[0].pageX,currY=a.touches[0].pageY,paper.setViewBox(paperShiftX,paperShiftY,paperWidth,paperHeight,!1),draggingEverythingIgnoreClick=!0)},!1),document.getElementById(raphaelDiv).addEventListener("touchend",function(a){a.preventDefault&&a.preventDefault(),mouseDown&&(mouseDown=!1)},!1),$(raphaelDivJQuery).mousedown(function(a){var t=a;0==t.button&&("tspan"==a.target.nodeName||void 0===t.offsetX?(currX=t.pageX,currY=t.pageY-($(document).height()-$("#raphael").height())):(currX=t.offsetX,currY=t.offsetY),mouseDown=!0)}),$(raphaelDivJQuery).mousemove(function(a){var t=!1;try{t=mouseOnMarker}catch(r){"ReferenceError"==r.name||console.error(r.stack)}if(mouseDown&&!t){var o=a;o.preventDefault&&o.preventDefault();var n=paperShiftX,e=paperShiftY,l=currX,i=currY,s=paperResizeRatio;if("tspan"==a.target.nodeName||void 0===o.offsetX){var p=o.pageX,g=o.pageY,d=$(document).height(),u=$("#raphael").height();n=Math.floor(n+(l-p)*s),e=Math.floor(e+(i-(g-(d-u)))*s),paperShiftX=n,paperShiftY=e,currX=p,currY=g-(d-u)}else{var S=o.offsetX,c=o.offsetY;n=Math.floor(n+(l-S)*s),e=Math.floor(e+(i-c)*s),paperShiftX=n,paperShiftY=e,currX=S,currY=c}paper.setViewBox(n,e,paperWidth,paperHeight,!1),draggingEverythingIgnoreClick=!0}}),$(raphaelDivJQuery).mouseup(function(){mouseDown=!1}),$(raphaelDivJQuery).bind("DOMMouseScroll",function(a){return a.originalEvent.detail<0?zoomIn():zoomOut(),!1}),$(raphaelDivJQuery).bind("mousewheel",function(a){return a.originalEvent.wheelDelta>0?zoomIn():zoomOut(),!1}),LOG.trace("Took "+(now()-a)+" ms to setup raphael")},50)});